_context.invoke("Nittro.Utils",function(Nittro,Strings,Arrays,HashMap,undefined){var Tokenizer=_context.extend(function(patterns,matchCase){var types=!1;if(!Array.isArray(patterns))if(patterns instanceof HashMap)types=patterns.getKeys(),patterns=patterns.getValues();else{var type,tmp=patterns;types=[],patterns=[];for(type in tmp)tmp.hasOwnProperty(type)&&(types.push(type),patterns.push(tmp[type]))}this._={pattern:"("+patterns.join(")|(")+")",types:types,matchCase:matchCase}},{STATIC:{getCoordinates:function(text,offset){text=text.substr(0,offset);var m=text.match(/\n/g);return[(m?m.length:0)+1,offset-("\n"+text).lastIndexOf("\n")+1]}},tokenize:function(input){var re,tokens,pos,n;return this._.types?(re=new RegExp(this._.pattern,"gm"+(this._.matchCase?"":"i")),tokens=[],pos=0,n=this._.types.length,input.replace(re,function(){var i,ofs=arguments[n+1];for(ofs>pos&&tokens.push([input.substr(pos,ofs-pos),pos,null]),i=1;i<=n;i++)if(arguments[i]!==undefined)return tokens.push([arguments[i],ofs,this._.types[i-1]]),void(pos=ofs+arguments[0].length);throw new Error("Unknown token type: "+arguments[0])}.bind(this)),pos+1<input.length&&tokens.push([input.substr(pos),pos,null])):tokens=Strings.split(input,new RegExp(this._.pattern,"m"+(this._.matchCase?"":"i")),!0,!0,!0),tokens}});_context.register(Tokenizer,"Tokenizer")},{Strings:"Utils.Strings",Arrays:"Utils.Arrays",HashMap:"Utils.HashMap"}),_context.invoke("Nittro.Neon",function(Nittro,HashMap,Tokenizer,Strings,Arrays,DateTime,undefined){var Neon=_context.extend(function(){this._cbStr=this._cbStr.bind(this)},{STATIC:{patterns:["'[^'\\n]*'|\"(?:\\\\.|[^\"\\\\\\n])*\"","(?:[^#\"',:=[\\]{}()\0- !`-]|[:-][^\"',\\]})\\s])(?:[^,:=\\]})(\0- ]|:(?![\\s,\\]})]|$)|[ \\t]+[^#,:=\\]})(\0- ])*","[,:=[\\]{}()-]","?:#.*","\\n[\\t ]*","?:[\\t ]+"],brackets:{"{":"}","[":"]","(":")"},consts:{"true":!0,True:!0,TRUE:!0,yes:!0,Yes:!0,YES:!0,on:!0,On:!0,ON:!0,"false":!1,False:!1,FALSE:!1,no:!1,No:!1,NO:!1,off:!1,Off:!1,OFF:!1,"null":null,Null:null,NULL:null},indent:"    ",BLOCK:1,encode:function(data,options){var tmp,s,isList;return data instanceof DateTime?data.format("Y-m-d H:i:s O"):data instanceof NeonEntity?(tmp=Neon.encode(data.attributes),Neon.encode(data.value)+"("+tmp.substr(1,tmp.length-2)+")"):data&&"object"==typeof data?(s=[],isList=Array.isArray(data),options&Neon.BLOCK?(Arrays.walk(data,function(k,v){v=Neon.encode(v,Neon.BLOCK),s.push(isList?"-":Neon.encode(k)+":",Strings.contains(v,"\n")?"\n"+Neon.indent+v.replace(/\n/g,"\n"+Neon.indent):" "+v,"\n")}),s.length?s.join(""):"[]"):(Arrays.walk(data,function(k,v){s.push(isList?"":Neon.encode(k)+": ",Neon.encode(v),", ")}),s.pop(),(isList?"[":"{")+s.join("")+(isList?"]":"}"))):"string"!=typeof data||Strings.isNumeric(data)||data.match(/[\x00-\x1F]|^\d{4}|^(true|false|yes|no|on|off|null)$/i)||!data.match(new RegExp("^"+Neon.patterns[1]+"$"))?JSON.stringify(data):data},decode:function(input){if("string"!=typeof input)throw new Error("Invalid argument, must be a string");Neon.tokenizer||(Neon.tokenizer=new Tokenizer(Neon.patterns)),input=input.replace(/\r/g,"");var res,parser=new Neon;for(parser.input=input,parser.tokens=Neon.tokenizer.tokenize(input),res=parser.parse(0,new HashMap);parser.tokens[parser.n]!==undefined;)"\n"===parser.tokens[parser.n][0].charAt(0)?parser.n++:parser.error();return res}},input:null,tokens:null,n:0,indentTabs:null,parse:function(indent,result){indent===undefined&&(indent=null),result===undefined&&(result=new HashMap);for(var t,inlineParser=null===indent,value=null,key=null,entity=null,hasValue=!1,hasKey=!1;this.n<this.tokens.length;this.n++)if(t=this.tokens[this.n][0],","===t)(hasKey||hasValue)&&inlineParser||this.error(),this.addValue(result,hasKey,key,hasValue?value:null),hasKey=hasValue=!1;else if(":"===t||"="===t)!hasKey&&hasValue||this.error(),"string"!=typeof value&&"number"!=typeof value&&this.error("Unacceptable key"),key=Strings.toString(value),hasKey=!0,hasValue=!1;else if("-"===t)(hasKey||hasValue||inlineParser)&&this.error(),key=null,hasKey=!0;else if(Neon.brackets[t]!==undefined)hasValue?("("!==t&&this.error(),this.n++,entity=new NeonEntity,entity.value=value,entity.attributes=this.parse(null,new HashMap),value=entity):(this.n++,value=this.parse(null,new HashMap)),hasValue=!0,this.tokens[this.n]!==undefined&&this.tokens[this.n][0]===Neon.brackets[t]||this.error();else{if("}"===t||"]"===t||")"===t){inlineParser||this.error();break}if("\n"===t.charAt(0))if(inlineParser)(hasKey||hasValue)&&(this.addValue(result,hasKey,key,hasValue?value:null),hasKey=hasValue=!1);else{for(;this.tokens[this.n+1]!==undefined&&"\n"===this.tokens[this.n+1][0].charAt(0);)this.n++;if(this.tokens[this.n+1]===undefined)break;var newIndent=this.tokens[this.n][0].length-1;if(null===indent&&(indent=newIndent),newIndent&&(null===this.indentTabs&&(this.indentTabs="\t"===this.tokens[this.n][0].charAt(1)),Strings.contains(this.tokens[this.n][0],this.indentTabs?" ":"\t")&&(this.n++,this.error("Either tabs or spaces may be used for indentation, not both"))),newIndent>indent)hasValue||!hasKey?(this.n++,this.error("Unexpected indentation")):this.addValue(result,null!==key,key,this.parse(newIndent,new HashMap)),newIndent=this.tokens[this.n]!==undefined?this.tokens[this.n][0].length-1:0,hasKey=!1;else{if(hasValue&&!hasKey)break;hasKey&&(this.addValue(result,null!==key,key,hasValue?value:null),hasKey=hasValue=!1)}if(newIndent<indent)return result}else hasValue&&this.error(),value='"'===t.charAt(0)?t.substr(1,t.length-2).replace(/\\(?:u[0-9a-f]{4}|x[0-9a-f]{2}|.)/gi,this._cbStr):"'"===t.charAt(0)?t.substr(1,t.length-2):Neon.consts[t]!==undefined?Neon.consts[t]:Strings.isNumeric(t)?parseFloat(t):t.match(/^\d\d\d\d-\d\d?-\d\d?(?:(?:[Tt]| +)\d\d?:\d\d(?::\d\d(?:\.\d*)?)? *(?:Z|[-+]\d\d?(?::?\d\d)?)?)?$/)?DateTime.from(t):t,hasValue=!0}return inlineParser?(hasKey||hasValue)&&this.addValue(result,hasKey,key,hasValue?value:null):hasValue&&!hasKey?result.length?this.error():result=value:hasKey&&this.addValue(result,null!==key,key,hasValue?value:null),result},addValue:function(result,hasKey,key,value){hasKey?(result&&result.has(key)&&this.error("Duplicated key "+key),result.set(key,value)):result.push(value)},_cbStr:function(m){var mapping={t:"\t",n:"\n",r:"\r",f:"\f",b:"\b",'"':'"',"\\":"\\","/":"/",_:"Â "};return mapping[m.charAt(1)]!==undefined?mapping[m.charAt(1)]:"u"===m.charAt(1)&&6===m.length?String.fromCharCode(parseInt(m.substr(2),16)):"x"===m.charAt(1)&&4===m.length?String.fromCharCode(parseInt(m.substr(2),16)):void this.error("Invalid escape sequence "+m)},error:function(msg){var last=this.tokens[this.n]!==undefined?this.tokens[this.n]:null,pos=Tokenizer.getCoordinates(this.input,last?last[1]:this.input.length),token=last?last[0].substr(0,40).replace(/\n/g,"<new line>"):"end";throw new Error((msg||"Unexpected %s").replace(/%s/g,token)+" on line "+pos[0]+", column "+pos[1])}}),NeonEntity=function(value,attributes){this.value=value||null,this.attributes=attributes||null};_context.register(Neon,"Neon"),_context.register(NeonEntity,"NeonEntity")},{HashMap:"Utils.HashMap",Strings:"Utils.Strings",Arrays:"Utils.Arrays",DateTime:"Utils.DateTime",Tokenizer:"Nittro.Utils.Tokenizer"});